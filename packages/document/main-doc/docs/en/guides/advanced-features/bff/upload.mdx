# File Upload

BFF, in conjunction with the [runtime framework](/guides/advanced-features/bff/frameworks.html) provides file upload capability, supporting integrated calling and manual calling with pure functions.

### BFF Function

First, create the `api/lambda/upload.ts` file:

```ts title="api/lambda/upload.ts"
import {
  Api,
  Upload,
  File,
  useFiles,
} from '@modern-js/runtime/server';
import { z } from 'zod';

const FileSchema = z.object({
  images: z.any(),
});

export const upload = Api(Upload('/upload'), File(FileSchema), async () => {
  const files = useFiles();

  return {
    data: {
      code: 0,
      message: 'success',
    },
  };
});
```
n the BFF function,  `useFiles()` can be used to retrieve the uploaded files. The return value is an Object, with the key being the field name used during upload.

### Integrated Calling


```tsx title="routes/upload/page.tsx"
import { upload } from '@api/upload';
import React from 'react';

export default (): JSX.Element => {
  const [file, setFile] = React.useState<FileList | null>();

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFile(e.target.files);
  };

  const handleUpload = () => {
    if (!file) {
      return;
    }
    upload({
      files: {
        images: file,
      },
    });
  };

  return (
    <div>
      <input multiple type="file" onChange={handleChange} />
      <button onClick={handleUpload}>upload</button>
    </div>
  );
};
```

### Manual Calling (Uploading via FormData)

```tsx title="routes/upload/page.tsx"
import React from 'react';

export default (): JSX.Element => {
  const [file, setFile] = React.useState<FileList | null>();

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFile(e.target.files);
  };

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    const formData = new FormData();
    if (file) {
      for (let i = 0; i < file.length; i++) {
        formData.append('file', file[i]);
      }
      await fetch('/api/upload', {
        method: 'POST',
        body: formData,
      });
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input multiple type="file" onChange={handleChange} />
      <button type="submit">upload</button>
    </form>
  );
};
```
